@using Microsoft.AspNetCore.Components.Authorization
@using RecipeForum_frontend.Infrastructure
@inject IRequestService RequestService
@inject AuthenticationStateProvider AuthProvider

<MudDialog>
    <DialogContent>
        <MudForm @ref="form">
            <MudGrid>
                <MudItem xs="12">
                    <MudTextField Label="Username"
                                  T="string"
                                  AdornmentIcon="@Icons.Material.Filled.SupervisorAccount"
                                  @bind-Value="Username"
                                  Required />
                </MudItem>
                <MudItem xs="12">
                    <MudTextField Label="Password"
                                  Required
                                  T="string"
                                  InputType="InputType.Password"
                                  AdornmentIcon="@Icons.Material.Filled.Key"
                                  @bind-Value="Password" />
                </MudItem>
                <MudItem>
                    <MudText>
                        If you don't have an account, create one <MudLink Href="">here</MudLink>
                    </MudText>
                </MudItem>
            </MudGrid>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="@Close">Close</MudButton>
        <MudButton OnClick="@OnSubmit">Login</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] public IMudDialogInstance Dialog { get; set; }

    private MudForm form = new();

    private string Username { get; set; }
    private string Password { get; set; }

    private async Task OnSubmit()
    {
        try
        {
            await form.Validate();
            if (form.IsValid)
            {
                await RequestService.LoginAsync(Username, Password);
                ((CookieAuthenticationStateProvider)AuthProvider).NotifyAuthenticationStateChanged();
                Snackbar.Add("Form valid", Severity.Success);
                
            }
        }
        catch (Exception)
        {

        }
    }

    private async Task Close()
    {
        Dialog.Close();
    }
}
