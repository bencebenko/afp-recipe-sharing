@page "/"
@using RecipeForum_frontend.Dialogs
@inject NavigationManager NavigationManager
@inject IUserService userService

<style>
    .card:hover{
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        cursor: pointer;
    }
</style>

<PageTitle>Home</PageTitle>

@if (IsLoggedIn)
{
    <MudGrid>
        <MudItem>
            <MudButton Variant="Variant.Filled" OnClick="@(() => OpenAddRecipeDialog())" StartIcon="@Icons.Material.Filled.Add" Color="Color.Primary">Add Recipe</MudButton>
        </MudItem>
    </MudGrid>
    <MudDivider />
}
<MudGrid Class="d-flex flex-wrap">
    
    @foreach (RecipeDto item in recipes)
    {
        <MudItem xs="12" sm="4">
            <MudCard Class="card" onclick="@(() => NavigateToRecipe(item.Id))">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.body1">@item.Name</MudText>
                        <MudText Typo="Typo.body2">@($"{item.Portion} - {item.CookTime}")</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardMedia Image="https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=800&h=600&fit=crop"  Height="250" />
                <MudCardActions>
                    <MudTooltip Text="Like">
                        <MudIconButton Icon="@Icons.Material.Filled.Favorite" Color="Color.Default" />
                    </MudTooltip>
                    <MudTooltip Text="More">
                        <MudIconButton Icon="@Icons.Material.Filled.Menu" OnClick="@(() => NavigateToRecipe(item.Id))" />
                    </MudTooltip>
                </MudCardActions>
            </MudCard>
        </MudItem>
    }
</MudGrid>
    
@code{
    private List<RecipeDto> recipes { get; set; }
    private bool IsLoggedIn = false;


    protected override async Task OnInitializedAsync()
    {
        await LoadRecipesAsync();
        IsLoggedIn = await userService.IsUserLoggedIn();
    }

    private async Task LoadRecipesAsync()
    {
        recipes = new();
        var result = await SwaggerClient.GetAllAsync();
        recipes = result?.ToList() ?? new();
    }

    private async Task OpenAddRecipeDialog()
    {
        var parameters = new DialogParameters();
        var options = new DialogOptions() { CloseButton = true, MaxWidth = MaxWidth.Medium, FullWidth = true };
        var dialog = await DialogService.ShowAsync<AddRecipeDialog>("Add New Recipe", parameters, options);
        var result = await dialog.Result;
        if (!result.Canceled)
        {
            await LoadRecipesAsync();
            StateHasChanged();
        }
    }

    private async Task NavigateToRecipe(long recipeId)
    {
        NavigationManager.NavigateTo($"/Recipe/{recipeId}");
    }
} 