 @page "/"
@using RecipeForum_frontend.Dialogs
@inject NavigationManager NavigationManager

<PageTitle>Home</PageTitle>

<MudGrid Class="d-flex flex-wrap">
    @foreach (RecipeDto item in recipes)
    {
        <MudItem xs="12" sm="4">
            <MudCard>
                <MudCardHeader>
                    @* <CardHeaderAvatar>
        <MudAvatar Color="Color.Secondary">I</MudAvatar>
    </CardHeaderAvatar> 
    Profile picture*@

                    <CardHeaderContent>
                        <MudText Typo="Typo.body1">@item.Name</MudText>
                        <MudText Typo="Typo.body2">@($"{item.Portion} - {item.CookTime}")</MudText>
                    </CardHeaderContent>
                    @*<CardHeaderActions>
                @if (true) If the current user is the author of this post the he/she can edit it
                {
                    <MudIconButton Icon="@Icons.Material.Filled.Settings" Color="Color.Default" />
                }
            </CardHeaderActions>*@
                </MudCardHeader>
                <MudCardContent Style="height: 250px;">
                    <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="250" />
                </MudCardContent>
                @*<MudCardMedia Image="images/pilars.jpg" Height="250" /> Some picture of the actual food*@
                <MudCardActions>
                    <MudTooltip Text="Like">
                        <MudIconButton Icon="@Icons.Material.Filled.Favorite" Color="Color.Default" />
                    </MudTooltip>
                    <MudTooltip Text="More">
                        <MudIconButton Icon="@Icons.Material.Filled.Menu" OnClick="@(() => NavigateToRecipe(item.Id))" />
                    </MudTooltip>
                </MudCardActions>
            </MudCard>
        </MudItem>

    }
</MudGrid>
    
@code{
    public MudDataGrid<RecipeDto> DataGrid { get; set; }
    private List<RecipeDto> recipes { get; set; } 


    protected override async Task OnInitializedAsync()
    {
        await LoadRecipesAsync();
    }

    private async Task LoadRecipesAsync()
    {
        var result = await SwaggerClient.GetAllAsync();
        recipes = result?.ToList() ?? new();
    }

    private async Task NavigateToRecipe(long recipeId)
    {
        NavigationManager.NavigateTo($"/Recipe/{recipeId}");
    }

    private async Task OpenLoginDialog()
    {
        var options = new DialogOptions()
        {
            CloseOnEscapeKey = true,
            MaxWidth = MaxWidth.Medium
        };
        var result = await DialogService.ShowAsync<Login>("Login", options);
    }
} 