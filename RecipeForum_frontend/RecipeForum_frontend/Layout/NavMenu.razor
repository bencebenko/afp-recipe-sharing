@using RecipeForum_frontend.Infrastructure
@inject NavigationManager Navigation
@inject CategoryFilterState CategoryFilterState
@inject SearchState SearchState

<MudToolBar Gutters="true" Style="width: 100%;">
    <MudButton OnClick="@(() => ResetAndNavigateToHome())" StartIcon="@Icons.Material.Outlined.DinnerDining">
        <MudHidden Breakpoint="Breakpoint.SmAndDown">RecipeSharing</MudHidden>
    </MudButton>

    <MudHidden Breakpoint="Breakpoint.SmAndDown">
        <MudSpacer />
        <MudNavMenu Class="nav-text d-md-flex mx-2">
            <MudNavLink OnClick="@(() => ResetAndNavigateToHome())" Icon="@Icons.Material.Filled.Home" Match="NavLinkMatch.All">Home</MudNavLink>
            <MudNavLink OnClick="CategoryFilterState.ToggleFilter" Icon="@Icons.Material.Filled.Interests">Categories</MudNavLink>
        </MudNavMenu>
    </MudHidden>

    <MudSpacer />

    @*Searchbar starts here...*@
    <MudHidden Breakpoint="Breakpoint.Xs">
        <MudTextField @bind-Value="SearchValue" Label="Search" Variant="Variant.Outlined" Adornment="Adornment.End"
                      AdornmentIcon="@Icons.Material.Filled.Search" AdornmentColor="Color.Dark"
                      Class="flex-shrink-1" Style="min-width: 150px; max-width: 300px; width: 30vw;" Immediate="true" />
    </MudHidden>

    <MudHidden Breakpoint="Breakpoint.SmAndUp">
        @if (_showMobileSearch)
        {
            <MudTextField @bind-Value="SearchValue" Placeholder="Searching..." Variant="Variant.Outlined" FullWidth="true"
                          Class="mx-2" Style="width: 100%;" Immediate="true" />

            <MudIconButton Icon="@Icons.Material.Filled.Close" Edge="Edge.End" OnClick="ToggleMobileSearch" />
        }
        else
        {
            <MudIconButton Icon="@Icons.Material.Filled.Search" Edge="Edge.End" OnClick="ToggleMobileSearch" />
        }
    </MudHidden>
    @*Searchbar ends here*@

    <MudHidden Breakpoint="Breakpoint.SmAndDown">
        <MudMenu AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
            <ActivatorContent>
                <MudAvatar Color="Color.Default" Variant="Variant.Filled">
                    <MudIcon Color="Color.Dark" Icon="@Icons.Material.Filled.AccountCircle" Size="Size.Large" />
                </MudAvatar>
            </ActivatorContent>
            <ChildContent>
                <AccountNavMenu />
            </ChildContent>
        </MudMenu>
    </MudHidden>

    @* Menu Drawer - EventCallback for MainBody's method *@
    <MudHidden Breakpoint="Breakpoint.MdAndUp">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Edge="Edge.End" OnClick="@(() => OnToggleDrawer.InvokeAsync())" />
    </MudHidden>
</MudToolBar>


@code {
    [Parameter]
    public EventCallback OnToggleDrawer { get; set; }

    private string _searchValue = string.Empty;
    public string SearchValue
    {
        get => _searchValue;
        set
        {
            if (_searchValue != value)
            {
                _searchValue = value;
                SearchState.SetSearchTerm(value);
            }
        }
    }

    private bool _showMobileSearch = false;

    private void ToggleMobileSearch()
    {
        _showMobileSearch = !_showMobileSearch;

        if (!_showMobileSearch)
        {
            SearchValue = string.Empty;
        }
    }

    private void ResetAndNavigateToHome()
    {
        SearchValue = string.Empty;
        CategoryFilterState.ResetFilter();
        Navigation.NavigateTo("/");
    }
}